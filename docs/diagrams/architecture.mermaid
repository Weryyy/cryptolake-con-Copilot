graph TB
    subgraph Sources["DATA SOURCES"]
        BinanceWS[Binance WebSocket<br/>Real-time prices]
        CoinGecko[CoinGecko API<br/>Historical data]
        FearGreed[Alternative.me<br/>Fear & Greed Index]
    end

    subgraph Ingestion["INGESTION LAYER"]
        KafkaProducer[Kafka Producer<br/>Python + confluent-kafka]
        BatchExtractors[Batch Extractors<br/>Python + requests]
    end

    subgraph Streaming["STREAMING"]
        Kafka[Apache Kafka<br/>Topic: prices.realtime]
    end

    subgraph Storage["LAKEHOUSE - MinIO + Apache Iceberg"]
        Bronze[ðŸ¥‰ BRONZE<br/>Raw data, append-only]
        Silver[ðŸ¥ˆ SILVER<br/>Clean, deduplicated]
        Gold[ðŸ¥‡ GOLD<br/>Star Schema]
    end

    subgraph Processing["PROCESSING"]
        SparkStreaming[Spark Structured Streaming<br/>Kafka â†’ Bronze]
        SparkBatch[Spark Batch<br/>Bronze â†’ Silver]
        dbt[dbt<br/>Silver â†’ Gold]
    end

    subgraph Orchestration["ORCHESTRATION"]
        Airflow[Apache Airflow<br/>DAGs & Scheduling]
    end

    subgraph Serving["SERVING LAYER"]
        FastAPI[FastAPI<br/>REST API]
        Streamlit[Streamlit<br/>Dashboard]
    end

    subgraph Quality["DATA QUALITY"]
        GE[Great Expectations<br/>Validation]
    end

    BinanceWS --> KafkaProducer --> Kafka
    CoinGecko --> BatchExtractors
    FearGreed --> BatchExtractors

    Kafka --> SparkStreaming --> Bronze
    BatchExtractors --> Bronze

    Bronze --> SparkBatch --> Silver
    Silver --> dbt --> Gold

    Airflow --> SparkBatch
    Airflow --> dbt
    Airflow --> BatchExtractors

    Gold --> FastAPI --> Streamlit
    Bronze --> GE
    Silver --> GE
